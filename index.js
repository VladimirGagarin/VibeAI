document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".floating-nav"),n=document.querySelector(".welcome-div"),t=document.querySelector(".menu-icon"),o=document.querySelector(".nav-items"),s=document.getElementById("tooltip");let i=!1,l=!1,a=!1,r=!1,c=null,d=0;const u=[],m={likedSongs:[],playLaterSongs:[],queuedSongs:[],userPlaylists:{}};let g=null,p=null;e.classList.add("handcuffs"),e.addEventListener("click",(n=>{n.stopPropagation(),i=!i,o.classList.toggle("show",i),e.classList.toggle("active",i),t.innerHTML=i?"<span>&times;</span>":"<span>&#9776;</span>"}));const h=document.querySelectorAll(".nav-items .icon"),y=document.querySelector(".title-assistant");function f(e){if(!e.type.startsWith("audio/"))return;if(e.size>104857600)return;const n={audioNumber:u.length+1,audioFile:e,audioName:e.name,audioUrl:URL.createObjectURL(e),audioModiefied:e.lastModified,audioSize:e.size,audioLiked:!1,audioPlayCount:0,moods:{RelaxationAndCalmness:!1,JoyAndPositivity:!1,LoveAndRomance:!1,MotivationAndEnergy:!1,SadnessAndReflection:!1,AggressionAndPower:!1,FunAndPartyVibes:!1,MysteryAndDrama:!1,NostalgiaAndMemories:!1,SeasonalAndContextual:!1,CulturalOrSpiritualConnection:!1},audiorRating:0,audioPlayHistory:[],audioDateCreated:A(new Date),preferredVibes:{morning:!1,evening:!1,bedtime:!1,anyTime:!0}};u.push(n),function(e){const n=document.querySelector(".container ul"),t=document.createElement("li");t.innerHTML=`\n        \n            <div class="song-number-and-name">\n                  <div class="number">\n                     <h3>${e.audioNumber}</h3>\n                  </div>\n                  <div class="song-name">\n                      <h3 data-audio-name='${e.audioName}'>${e.audioName}</h3>\n                  </div>\n               </div>\n\n               <div class="song-play-icon">\n                  <span>&#9654;</span>\n               </div>\n\n               <div class="song-time-graph">\n                  <span>00:00</span> / <span>00:00</span>\n               </div>\n\n               <div class="bottom-section">\n\n                  <div class="song-progress-truck">\n                     <div class="song-progress-bar"></div>\n                  </div>\n   \n                  <div class="song-more-details">\n                     <span>&#8942;</span>\n                  </div>\n\n               </div>`,n.appendChild(t);const o=t.querySelector(".song-play-icon span"),s=t.querySelectorAll(".song-time-graph span")[1],i=t.querySelectorAll(".song-time-graph span")[0],l=t.querySelector(".song-progress-bar");t.querySelector(".song-play-icon").onclick=function(){L(e.audioUrl,t,o,s,i,l,e)},t.querySelector(".song-more-details").onclick=function(n){n.stopPropagation(),function(e,n){const t=n.querySelector(".song-detail-list");t&&t.remove();const o=document.createElement("div");o.classList.add("song-detail-list");const s=document.createElement("ul");o.appendChild(s);let i=e.audioLiked;[{content:"&#10084;",label:"Like song"},{content:"&#128338;",label:"Listen to song later"},{content:"&#9776; ",label:"Add song to queue"},{content:"&#127911; ",label:"Add song to playlist"},{content:"&#8505;",label:"View song details"}].forEach(((t,l)=>{const r=document.createElement("li");r.innerHTML=t.content,r.setAttribute("aria-label",t.label),s.appendChild(r);const c=document.createElement("div");switch(c.classList.add("title-assistant"),c.textContent=t.label,document.body.appendChild(c),r.addEventListener("mouseenter",(e=>{const n=e.target.getAttribute("aria-label");c.textContent=n;const t=e.target.getBoundingClientRect();let o=t.right+10,s=t.top;o+c.offsetWidth>window.innerWidth&&(o=window.innerWidth-c.offsetWidth-10),s+c.offsetHeight>window.innerHeight&&(s=window.innerHeight-c.offsetHeight-10),o+=window.scrollX,s+=window.scrollY,c.style.left=`${o}px`,c.style.top=`${s}px`,c.style.display="block"})),r.addEventListener("mouseleave",(()=>{c.style.display="none"})),r.addEventListener("mouseleave",(()=>{c.style.display="none"})),l){case 0:r.classList.toggle("liked",i),r.addEventListener("click",(function(){i=!i,r.classList.toggle("liked",i),e.audioLiked=i,p===n&&(o.style.display="none",n.classList.remove("highlight"))}));break;case 1:const s=m.playLaterSongs.includes(e.audioName);r.classList.toggle("later",s),r.addEventListener("click",(()=>{if(m.playLaterSongs.includes(e.audioName)){const n=m.playLaterSongs.indexOf(e.audioName);-1!==n&&m.playLaterSongs.splice(n,1),r.innerHTML=t.content,r.classList.remove("later")}else m.playLaterSongs.push(e.audioName),r.classList.add("later");p===n&&(o.style.display="none",n.classList.remove("highlight"))}));break;case 2:const l=m.queuedSongs.includes(e.audioName);r.classList.toggle("queued",l),r.addEventListener("click",(()=>{if(m.queuedSongs.includes(e.audioName)){const n=m.queuedSongs.indexOf(e.audioName);-1!==n&&m.queuedSongs.splice(n,1),r.innerHTML=t.content,r.classList.remove("queued"),E(e,!1)}else m.queuedSongs.push(e.audioName),r.classList.add("queued"),E(e,!0);p===n&&(o.style.display="none",n.classList.remove("highlight"))}));break;case 3:r.addEventListener("click",(()=>{a()}));break;case 4:r.addEventListener("click",(()=>{a(),function(e){const n=document.querySelector(".song-info-overlay"),t=document.querySelector(".song-number-name .song-info-name"),o=document.querySelector(".song-number-name .song-info-number"),s=document.querySelector(".song-info-intelList ul");s.innerHTML="";const i={text:"Song size",content:v(e.audioSize)},l={text:"Song Last Modified",content:A(new Date(e.audioModiefied))},a={text:"Song Liked",content:e.audioLiked?"Yes":"No"},r={text:"Date Created",content:e.audioDateCreated},c={text:"Play Count",content:e.audioPlayCount},d={text:"User Rating",content:e.audiorRating},u={text:"Preferred Vibes",content:w(e.preferredVibes)},m={text:"Audio Play History",content:e.audioPlayHistory.length?e.audioPlayHistory.map((e=>A(new Date(e)))).join("\n , "):"No history available"},g=[a,d,u];[i,l,r,c,m].forEach((e=>{b(e,s,!1)})),g.forEach((e=>{b(e,s,!0)})),o.innerHTML=`<h3>${e.audioNumber}</h3>`,t.innerHTML=`<p>${e.audioName}</p>`,n.style.display="flex"}(e)}))}}));const l=document.createElement("div");function a(){o.style.display="none",n.classList.remove("highlight"),document.removeEventListener("click",r)}function r(e){o.contains(e.target)||e.target===n||a()}l.innerHTML="<span>&times;</span>",l.classList.add("song-close"),l.setAttribute("aria-label","Close song details"),o.appendChild(l),l.onclick=function(){o.style.display="none",n.classList.remove("highlight")},n.appendChild(o),o.style.display="block",n.classList.add("highlight"),document.addEventListener("click",r)}(e,t)}}(n),console.table(u)}function L(e,n,t,o,s,i,h){g&&p&&p!==n&&(g.pause(),p.querySelector(".song-play-icon span").innerHTML="&#9654;",p.querySelectorAll(".song-time-graph span")[0].textContent="00:00",p.querySelectorAll(".song-time-graph span")[1].textContent="00:00",p.querySelector(".song-progress-bar").style.width="0");const y=u.find((n=>n.audioUrl===e));if(y.audioPlayCount>=5&&u.length>3&&!l)return g.pause(),alert("This song has been played more than once"),t.innerHTML="&#9654;",o.textContent="00:00",s.textContent="00:00",void(i.style.width="0");if(p&&g&&!g.paused&&p===n)return g.pause(),t.innerHTML="&#9654;",r=!1,void(l&&a&&!r&&(document.querySelectorAll(".queued-controls button")[1].innerHTML="&#9654;"));if((!g||!p||g.src!==e)&&(g=new Audio(e),p=n,p.scrollIntoView({behavior:"smooth",block:"center"}),y)){const e=new Date;y.audioPlayHistory.push(e)}g.play(),t.innerHTML="&#10074;&#10074;",r=!0,l&&a&&r&&(document.querySelectorAll(".queued-controls button")[1].innerHTML="&#10074;&#10074;"),g.onloadedmetadata=()=>{o.textContent=q(g.duration)},g.ontimeupdate=()=>{if(!g.duration||isNaN(g.duration))return;const e=g.currentTime/g.duration*100;s.textContent=q(g.currentTime),i.style.width=`${e}%`},g.addEventListener("ended",(()=>{t.innerHTML="&#9654;",o.textContent="00:00",s.textContent="00:00",i.style.width="0",g.currentTime=0,r=!1;const n=u.find((n=>n.audioUrl===e||n.audioNumber===h.audioNumber));n&&(n.audioPlayCount+=1,console.log(n),c=n),u.length<=10&&!l&&S(),l&&(m.queuedSongs.length<=10?(C(),d=(d+1)%m.queuedSongs.length):d<m.queuedSongs.length-1?(C(),d++):(console.log("No more songs to play."),S()))}))}h.forEach((e=>{e.addEventListener("mouseenter",(e=>{const n=e.target.getAttribute("data-title");y.textContent=n;const t=e.target.getBoundingClientRect();let o=t.right+10,s=t.top+window.scrollY;o+y.offsetWidth>window.innerWidth&&(o=window.innerWidth-y.offsetWidth-10),s+y.offsetHeight>window.innerHeight+window.scrollY&&(s=window.innerHeight+window.scrollY-y.offsetHeight-10),y.style.left=`${o}px`,y.style.top=`${s}px`,y.style.display="block"})),e.addEventListener("mouseleave",(()=>{y.style.display="none"}))})),document.addEventListener("click",(function(n){e.contains(n.target)||o.contains(n.target)||!o.classList.contains("show")||(o.classList.remove("show"),e.classList.remove("active"),t.innerHTML="<span>&#9776;</span>",i=!1)})),document.querySelector("#MusicInput").addEventListener("change",(function(){const t=this.files;t&&Array.from(t).forEach(((t,o)=>{setTimeout((function(){f(t)}),1e3),n.style.display="none",e.classList.remove("handcuffs")}))})),document.querySelectorAll(".nav-items div").forEach(((n,l)=>{n.addEventListener("click",(function(){!function(n){let l="";switch(s.innerHTML="",e.classList.add("handcuffs"),n){case 0:l=function(){const n=document.createElement("div");n.classList.add("toolTip-container");const t=document.createElement("h2");t.textContent="Upload Your Audio Files here",n.appendChild(t);const o=document.createElement("label");o.innerHTML="&#8682; Upload Here",o.setAttribute("for","SongInput"),n.appendChild(o);const i=document.createElement("input");i.id="SongInput",i.type="file",i.accept="audio/*",i.multiple=!0,n.appendChild(i);const l=document.createElement("div");return l.classList.add("close-tooltip"),l.innerHTML="<span>&times;</span>",n.appendChild(l),i.addEventListener("change",(()=>{e.classList.add("handcuffs");const n=i.files;n.length>0&&(console.log(`${n.length} file(s) selected:`),Array.from(n).forEach((n=>{setTimeout((function(){f(n),e.classList.remove("handcuffs")}),1e3)})),s.style.display="none")})),l.addEventListener("click",(function(){s.style.display="none",e.classList.remove("handcuffs")})),n}();break;case 1:l="Browse your music list";break;case 2:p&&p?(p.scrollIntoView({behavior:"smooth",block:"center"}),p.classList.add("highlight"),setTimeout((function(){p.classList.remove("highlight")}),3e3),g.paused&&(g.play(),p.querySelector(".song-play-icon span").innerHTML="&#10074;&#10074;")):window.scrollTo({top:0,behavior:"smooth"}),o.classList.remove("show"),e.classList.remove("active"),t.innerHTML=" <span>&#9776;</span>",e.classList.remove("handcuffs"),i=!1;break;case 3:l="Browse music categories";break;default:l="Unknown action"}s.appendChild(l),s.style.display="flex"}(l),o.classList.remove("show"),e.classList.remove("active"),t.innerHTML=" <span>&#9776;</span>",e.classList.remove("handcuffs"),i=!1}))}));const q=e=>{const n=Math.floor(e/60),t=Math.floor(e%60);return`${n<10?`0${n}`:n} : ${t<10?`0${t}`:t}`},v=e=>e<1024?`${e} B`:e<1048576?(e/1024).toFixed(2)+" KB":e<1073741824?(e/1048576).toFixed(2)+" MB":(e/1073741824).toFixed(2)+" GB";function S(){let e=6;const n=document.querySelector(".song-recommendation-timer-overlay"),t=document.querySelector(".song-recommendation-title p"),o=document.querySelector(".song-recommendation-timer span"),s=document.querySelector(".song-recommendation-controls button"),i=document.querySelectorAll(".container ul li"),r=u.filter((e=>e!==c&&e.audioPlayCount<1)),d=r[Math.floor(Math.random()*r.length)];if(0===r.length)return void console.warn("No songs available to recommend.");const m=Array.from(i).find((e=>e.querySelector(".song-number-and-name .song-name h3")?.dataset.audioName===d.audioName));if(!m)return void console.error("No matching <li> found for the random song.");const g=d.audioUrl,p=m,h=m.querySelector(".song-play-icon span"),y=m.querySelectorAll(".song-time-graph span")[1],f=m.querySelectorAll(".song-time-graph span")[0],q=m.querySelector(".song-progress-bar"),v=d;t.textContent=d.audioName,n.style.display="flex";const S=setInterval((()=>{e--,o.textContent=e<10?`0${e}`:e,e<=0&&(clearInterval(S),"flex"===n.style.display&&(L(g,p,h,y,f,q,v),n.style.display="none",p.classList.add("highlight"),setTimeout((function(){p.classList.remove("highlight")}),3e3),a=!1,l=!1,document.querySelectorAll(".queued-controls button").forEach((e=>{e.disabled=!0}))))}),1e3);s.onclick=function(){clearInterval(S),n.style.display="none"}}function b(e,n,t){const o=document.createElement("li");o.innerHTML=t?` <p><strong>${e.text}:</strong> <span> ${e.content}</span> <button>Edit</button></p>`:` <p><strong>${e.text}:</strong> <span> ${e.content}</span></p>`,n.appendChild(o)}function w(e){return Object.keys(e).filter((n=>e[n])).map((e=>{return(n=e).charAt(0).toUpperCase()+n.slice(1);var n})).join(", ")||"None"}function A(e){return e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}document.querySelector(".song-info-close").onclick=function(){document.querySelector(".song-info-overlay").style.display="none"};let k=!1;function E(e,n){const t=document.querySelector(".queued-bucket-list"),o=document.querySelector(".dropdown-queued-list-icon"),s=document.querySelector(".expanded-items ul");o.onclick=function(){k=!k,t.classList.toggle("expand",k)};const i=Array.from(s.children).find((n=>n.querySelector("p[data-songName]").dataset.songname===e.audioName));if(i&&!n){const n=m.queuedSongs.indexOf(e.audioName);-1!==n&&(m.queuedSongs.splice(n,1),console.log("Updated queuedSongs after removal:",m.queuedSongs),x()),i.remove()}else if(!i&&n){const n=document.createElement("li");n.innerHTML=`<p data-songName = '${e.audioName}'>${e.audioName}</p>`,console.table(m.queuedSongs);const o=document.createElement("button");o.innerHTML="&#10060",o.onclick=function(){const o=m.queuedSongs.indexOf(e.audioName);-1!==o&&m.queuedSongs.splice(o,1),n.remove(),t.style.display=s.children.length>0?"flex":"none",l=s.children.length>0,x()},n.appendChild(o),s.appendChild(n)}t.style.display=s.children.length>0?"flex":"none",l=s.children.length>0,console.log("HasQuedSongs :",l),document.querySelectorAll(".queued-controls button").forEach((e=>{e.disabled=s.children.length>=1})),console.log("Final queuedSongs state:",m.queuedSongs);new MutationObserver((()=>{x()})).observe(s,{childList:!0,subtree:!0})}function x(){document.querySelector(".expanded-items ul").children.length>=1&&l&&a?(document.querySelectorAll(".queued-controls button").forEach((e=>{e.disabled=!1})),g&&!g.paused?(document.querySelectorAll(".queued-controls button")[1].innerHTML="&#10074;&#10074;",r=!0):(document.querySelectorAll(".queued-controls button")[1].innerHTML="&#9654;",r=!1)):document.querySelectorAll(".queued-controls button").forEach((e=>{e.disabled=!0}))}function C(){if(d<m.queuedSongs.length-1){const e=m.queuedSongs[d],n=u.find((n=>n.audioName===e));if(!n)return;const t=document.querySelectorAll(".container ul li"),o=n.audioUrl,s=Array.from(t).find((e=>e.querySelector(".song-number-and-name .song-name h3")?.dataset.audioName===n.audioName));if(!s)return;const i=s.querySelector(".song-play-icon span"),l=s.querySelectorAll(".song-time-graph span")[1],r=s.querySelectorAll(".song-time-graph span")[0],c=s.querySelector(".song-progress-bar"),g=document.querySelectorAll(".expanded-items ul li")[d];L(o,s,i,l,r,c,n),a=!0,x(),document.querySelectorAll(".expanded-items ul li").forEach((e=>{e.classList.remove("highlighted")})),g.classList.add("highlighted"),s.classList.add("highlight"),setTimeout((function(){s.classList.remove("highlight")}),1e3)}else a=!1}document.querySelectorAll(".queued-controls button")[1].addEventListener("click",(function(){r=!r,this.innerHTML=r?"&#10074;&#10074;":"&#9654;",p&&(p.querySelector(".song-play-icon span").innerHTML=r?"&#10074;&#10074;":"&#9654;"),r?g.play():g.pause()})),document.querySelectorAll(".queued-controls button")[0].onclick=function(){d>0&&(d--,C()),0===d&&(this.disabled=!0),document.querySelectorAll(".queued-controls button")[2].disabled=!1},document.querySelectorAll(".queued-controls button")[2].onclick=function(){d<m.queuedSongs.length-1&&(d++,C()),d>=m.queuedSongs.length-1&&(this.disabled=!0),document.querySelectorAll(".queued-controls button")[0].disabled=!1},document.querySelector(".queued-close").onclick=function(){0!==m.queuedSongs.length&&(m.queuedSongs=[],document.querySelectorAll(".expanded-items ul li").forEach((e=>e.remove())),l=!1,a=!1,document.querySelectorAll(".queued-controls button").forEach((e=>{e.disabled=!0})),document.querySelector(".queued-bucket-list").style.display="none",alert("The queue has been cleared!"))}})),"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("service-worker.js").then((e=>{console.log("Service Worker registered with scope:",e.scope)})).catch((e=>{console.log("Service Worker registration failed:",e)}))}));
